<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tendas Tensionadas Personalizadas - Malhas tensionadas de alta performance projetadas sob medida">
    <meta name="keywords" content="tendas tensionadas, estruturas personalizadas, malhas tensionadas">
    <title>Tendas Tensionadas Personalizadas - Psik√© Deloun Arts</title>
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/android-chrome-512x512.png">
    <link rel="manifest" href="assets/images/site.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Bot√£o de Carrinho Fixo -->
    <a href="carrinho.html" class="cart-button" id="cartButton" aria-label="Ver carrinho">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
        <span class="cart-badge" id="cartBadge">0</span>
    </a>

    <!-- Header -->
    <header class="page-header">
        <div class="container">
            <a href="index.html" class="header-logo">
                <img src="assets/images/logo.png" alt="Psik√© Deloun Arts Logo">
            </a>
            <nav class="header-nav">
                <a href="index.html">In√≠cio</a>
                <a href="produtos.html" class="active">Produtos</a>
                <a href="carrinho.html">Carrinho</a>
            </nav>
        </div>
    </header>

    <!-- P√°gina do Produto -->
    <section class="product-page">
        <div class="container">
            <div class="product-page-content">
                <!-- Cabe√ßalho do Produto (acima de tudo) -->
                <div class="product-header-top">
                    <div class="product-breadcrumb">
                        <a href="index.html">In√≠cio</a> / <a href="produtos.html">Produtos</a> / <span>Tendas Tensionadas</span>
                    </div>
                    
                    <h1 class="product-page-title">Tendas Tensionadas Personalizadas</h1>
                </div>

                <!-- Linha 1: Imagem | A√ß√µes -->
                <div class="product-row-1">
                    <!-- Foto -->
                    <div class="product-gallery">
                        <div class="product-main-image">
                            <img src="" alt="Tenda tensionada personalizada" id="mainProductImage">
                            <!-- Setas de navega√ß√£o do carrossel (apenas se houver varia√ß√µes) -->
                            <button class="carousel-nav carousel-prev" id="carouselPrev" onclick="previousImage()" aria-label="Imagem anterior" style="display: none;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <button class="carousel-nav carousel-next" id="carouselNext" onclick="nextImage()" aria-label="Pr√≥xima imagem" style="display: none;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </button>
                            <!-- Indicadores do carrossel (apenas se houver varia√ß√µes) -->
                            <div class="carousel-indicators" id="carouselIndicators" style="display: none;"></div>
                        </div>
                    </div>

                    <!-- A√ß√µes -->
                    <div class="product-dimensions-large" data-product-type="tent">
                        <div class="dimensions-header">
                            <h3 class="dimensions-title-large">Informe as Dimens√µes</h3>
                            <p class="dimensions-subtitle-large">R$ 22,00 por m¬≤</p>
                        </div>
                        
                        <p class="product-page-description">
                            Tendas personalizadas sob medida, ideais para eventos e instala√ß√µes fixas.                        </p>
                        <div class="dimensions-inputs-large">
                            <div class="dimension-input-group-large">
                                <label for="tent-height-large" class="dimension-label-large">Comprimento (m)</label>
                                <div class="dimension-input-wrapper">
                                    <input type="number" id="tent-height-large" class="dimension-input-large" min="0" step="0.1" placeholder="Ex: 5.0" oninput="calculateTentPriceLarge('tendas'); updateProductTitle();">
                                    <button type="button" class="dimension-input-btn dimension-input-btn-up" onclick="incrementDimension('tent-height-large')">‚Üë</button>
                                    <button type="button" class="dimension-input-btn dimension-input-btn-down" onclick="decrementDimension('tent-height-large')">‚Üì</button>
                                </div>
                            </div>
                            <div class="dimension-input-group-large">
                                <label for="tent-width-large" class="dimension-label-large">Largura (m)</label>
                                <div class="dimension-input-wrapper">
                                    <input type="number" id="tent-width-large" class="dimension-input-large" min="0" step="0.1" placeholder="Ex: 3.0" oninput="calculateTentPriceLarge('tendas'); updateProductTitle();">
                                    <button type="button" class="dimension-input-btn dimension-input-btn-up" onclick="incrementDimension('tent-width-large')">‚Üë</button>
                                    <button type="button" class="dimension-input-btn dimension-input-btn-down" onclick="decrementDimension('tent-width-large')">‚Üì</button>
                                </div>
                            </div>
                        </div>
                        <div class="price-display-large" id="tent-price-display-large">
                            <span class="price-label-large">Pre√ßo Total:</span>
                            <span class="price-value-large" id="tent-price-value-large">R$ 0,00</span>
                        </div>
                        
                        <!-- A√ß√µes dentro do mesmo card -->
                        <div class="product-actions-large">
                            <button class="btn-primary-large" id="btn-add-tent-large" data-product-id="tendas" data-product-name="Tendas Tensionadas Personalizadas" data-product-image="" data-product-specs="Envio nacional, consultar frete.">
                                Adicionar ao Carrinho
                            </button>
                            <a href="produtos.html" class="product-link-secondary">Ver Outros Produtos</a>
                        </div>
                    </div>
                </div>

                <!-- Linha 2: Informa√ß√µes em cards -->
                <div class="product-info-full">
                    <div class="product-specs-grid">
                        <!-- Card 1: Especifica√ß√µes -->
                        <div class="spec-card">
                            <h3 class="shipping-title">ESPECIFICA√á√ïES</h3>
                            <ul class="shipping-list">
                                <li>Envio para todo o Brasil</li>
                                <li>Suplex - gramatura 280</li>
                                <li>Dimens√µes e cores personalizadas</li>
                                <li>Materiais de alta durabilidade</li>
                                <li>Acabamento profissional</li>
                            </ul>
                        </div>
                        
                        <!-- Card 2: Formas de Pagamento -->
                        <div class="spec-card">
                            <h3 class="shipping-title">FORMAS DE PAGAMENTO</h3>
                            <ul class="shipping-list">
                                <li>PIX</li>
                                <li>Cart√£o de cr√©dito</li>
                                <li>Cart√£o de d√©bito</li>
                            </ul>
                        </div>
                        
                        <!-- Card 3: Prazo -->
                        <div class="spec-card">
                            <h3 class="shipping-title">PRAZO</h3>
                            <ul class="shipping-list">
                                <li>Produ√ß√£o: 8 a 10 dias ap√≥s confirma√ß√£o</li>
                                <li>Prazo de entrega: conforme localidade e modalidade de frete escolhida</li>
                                <li>Consulte prazo espec√≠fico para seu projeto</li>
                            </ul>
                        </div>
                        
                        <!-- Card 4: Frete e Condi√ß√µes -->
                        <div class="spec-card">
                            <h3 class="shipping-title">FRETES E CONDI√á√ïES</h3>
                            <ul class="shipping-list">
                                <li>Frete n√£o incluso</li>
                                <li>Valor do frete varia com o peso e modelo</li>
                                <li>Consulte valores e condi√ß√µes</li>
                                <li>Valores das tendas sujeitos a altera√ß√£o</li>
                                <li><strong>Obs:</strong> O valor do produto √© cobrado separado do valor do frete.</li>
                            </ul>
                        </div>
                        
                        <!-- Card 5: Incluso -->
                        <div class="spec-card">
                            <h4 class="shipping-not-included-title">INCLUSO</h4>
                            <p class="shipping-not-included-text">Tenda em malha tensionada personalizada conforme especifica√ß√µes, acabamento profissional, costuras refor√ßadas, olhais para fixa√ß√£o, e orienta√ß√µes de montagem.</p>
                        </div>
                        
                        <!-- Card 6: N√£o Incluso -->
                        <div class="spec-card">
                            <h4 class="shipping-not-included-title">N√ÉO INCLUSO</h4>
                            <p class="shipping-not-included-text">Cordas, estruturas de sustenta√ß√£o, frete e m√£o de obra presencial (quando n√£o contratada).</p>
                        </div>
                        
                        <!-- Card 7: Observa√ß√µes -->
                        <div class="spec-card spec-card-full">
                            <h3 class="shipping-title">OBSERVA√á√ïES</h3>
                            <ul class="shipping-list">
                                <li>As imagens representam o resultado final</li>
                                <li>As cores podem variar conforme o monitor e impress√£o</li>
                                <li>Dimens√µes personalizadas sujeitas a aprova√ß√£o t√©cnica</li>
                                <li>Para projetos especiais, consulte nossa equipe para or√ßamento detalhado</li>
                                <li>Recomendamos consulta pr√©via para projetos com dimens√µes acima de 20m¬≤</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Produtos Relacionados / Sugest√µes -->
            <div class="related-products-section">
                <h2 class="related-products-title">Voc√™ tamb√©m pode gostar</h2>
                <div class="related-products-grid" id="relatedProductsGrid">
                    <!-- Produtos relacionados ser√£o inseridos aqui via JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer-capture" id="contato">
        <div class="container">
            <div class="footer-content">
                <h2 class="footer-title">Se existe um limite, n√≥s tensionamos at√© romper.</h2>
                <p class="footer-subtitle">Vamos construir a identidade do seu pr√≥ximo evento.</p>
                <a href="index.html" class="btn-primary">Voltar ao In√≠cio</a>
            </div>
        </div>
    </footer>

    <script src="scripts/main.js"></script>
    <script>
        // Fun√ß√£o removida - apenas foto principal da tenda ser√° exibida

        // Vari√°vel global para armazenar tipo da tenda atual
        let currentTentType = null;
        let currentTentCanCalculate = true;
        let currentTent = null; // Armazenar objeto da tenda atual
        
        // Fun√ß√£o auxiliar para obter pre√ßo fixo (usa fun√ß√£o global de main.js)
        function getMandalaFixedPriceLocal(tendaCode, width, height) {
            if (typeof window.getMandalaFixedPrice === 'function') {
                return window.getMandalaFixedPrice(tendaCode, width, height);
            }
            return null;
        }

        // Calcular pre√ßo na p√°gina de detalhes
        window.calculateTentPriceLarge = function(productId) {
            const heightInput = document.getElementById('tent-height-large');
            const widthInput = document.getElementById('tent-width-large');
            const priceDisplay = document.getElementById('tent-price-value-large');
            const priceLabel = document.querySelector('#tent-price-display-large .price-label-large');
            const addButton = document.getElementById('btn-add-tent-large');
            
            if (!heightInput || !widthInput || !priceDisplay) {
                return 0;
            }
            
            // Se n√£o pode calcular (MANDALA), usar pre√ßo fixo
            if (!currentTentCanCalculate && currentTent) {
                const fixedPrice = getMandalaFixedPriceLocal(currentTent.tendaCode, currentTent.width, currentTent.height);
                if (fixedPrice) {
                    if (priceLabel) {
                        priceLabel.textContent = 'Pre√ßo:';
                    }
                    priceDisplay.textContent = new Intl.NumberFormat('pt-BR', {
                        style: 'currency',
                        currency: 'BRL',
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }).format(fixedPrice);
                    if (addButton) {
                        addButton.disabled = false;
                        addButton.style.opacity = '1';
                        addButton.style.cursor = 'pointer';
                    }
                    return fixedPrice;
                } else {
                    // Se n√£o tem pre√ßo fixo, mostrar "Sob consulta"
                    if (priceLabel) {
                        priceLabel.textContent = 'Pre√ßo:';
                    }
                    priceDisplay.textContent = 'Sob consulta com o vendedor';
                    if (addButton) {
                        addButton.disabled = false;
                        addButton.style.opacity = '1';
                        addButton.style.cursor = 'pointer';
                    }
                    return 0;
                }
            }
            
            const height = parseFloat(heightInput.value) || 0;
            const width = parseFloat(widthInput.value) || 0;
            
            const area = height * width;
            const price = area * 22.00;
            
            if (priceLabel) {
                priceLabel.textContent = 'Pre√ßo Total:';
            }
            priceDisplay.textContent = new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(price);
            
            if (addButton) {
                if (height > 0 && width > 0) {
                    addButton.disabled = false;
                    addButton.style.opacity = '1';
                    addButton.style.cursor = 'pointer';
                } else {
                    addButton.disabled = true;
                    addButton.style.opacity = '0.5';
                    addButton.style.cursor = 'not-allowed';
                }
            }
            
            return price;
        };

        // Produtos relacionados - outras tendas do cat√°logo
        function getRelatedTents(currentId) {
            if (typeof TENT_CATALOG === 'undefined') return [];
            
            // Filtrar tendas diferentes da atual (comparar baseId)
            const otherTents = TENT_CATALOG.filter(tent => tent.baseId !== currentId);
            
            // Embaralhar e pegar 4 aleat√≥rias
            const shuffled = shuffleArray(otherTents);
            return shuffled.slice(0, 4);
        }

        // Embaralhar e mostrar produtos relacionados
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function renderRelatedProducts() {
            const grid = document.getElementById('relatedProductsGrid');
            if (!grid) return;

            const params = getURLParams();
            const currentId = params.id || 'tenda-14x14';
            const relatedTents = getRelatedTents(currentId);

            if (relatedTents.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: var(--color-text-secondary);">Nenhuma tenda relacionada dispon√≠vel.</p>';
                return;
            }

            grid.innerHTML = relatedTents.map(tent => {
                // Usar mainImage se dispon√≠vel, sen√£o usar a primeira imagem dispon√≠vel
                const imageSrc = tent.mainImage || (tent.allImages && tent.allImages.length > 0 ? tent.allImages[0].image : '');
                return `
                <article class="related-product-card">
                    <a href="tenda.html?w=${tent.width}&h=${tent.height}&id=${tent.baseId || tent.id}">
                        <div class="related-product-image">
                            <img src="${imageSrc}" alt="Tenda ${tent.width}m x ${tent.height}m" loading="lazy">
                        </div>
                        <div class="related-product-content">
                            <h3 class="related-product-title">${formatTentTitle(tent.width, tent.height, tent)}</h3>
                        </div>
                    </a>
                </article>
            `;
            }).join('');
        }

        // Obter par√¢metros da URL
        function getURLParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                width: params.get('w') || params.get('width'),
                height: params.get('h') || params.get('height'),
                id: params.get('id')
            };
        }

        // Fun√ß√£o auxiliar para formatar t√≠tulo com √°rea
        function formatTentTitle(width, height, tent = null) {
            if (width > 0 && height > 0) {
                // Se tiver objeto tent com √°rea (para MANDALA), usar √°rea fixa
                let area;
                if (tent && tent.area) {
                    area = tent.area;
                } else if (tent && tent.type === 'MANDALA' && tent.tendaCode) {
                    // Buscar √°rea fixa para MANDALA
                    const mandalaAreas = {
                        '8x8_tenda1': 51,
                        '11x11_tenda2': 86,
                        '13x13_tenda3': 129,
                        '11x11_tenda4': 93,
                        '14x14_tenda5': 155,
                        '14x14_tenda6': 155,
                        '21x21_tenda7': 326,
                        '23x23_tenda8': 344,
                        '24x24_tenda9': 460,
                        '26x26_tenda10': 480,
                        '33x33_tenda11': 754
                    };
                    const key = `${width}x${height}_${tent.tendaCode}`;
                    area = mandalaAreas[key] || (width * height);
                } else {
                    area = width * height;
                }
                return `Tenda ${width}m √ó ${height}m (${area.toFixed(0)}m¬≤)`;
            }
            return 'Tendas Tensionadas Personalizadas';
        }

        // Atualizar t√≠tulo dinamicamente
        window.updateProductTitle = function() {
            const widthInput = document.getElementById('tent-width-large');
            const heightInput = document.getElementById('tent-height-large');
            const pageTitle = document.querySelector('.product-page-title');
            
            if (widthInput && heightInput && pageTitle) {
                const width = parseFloat(widthInput.value) || 0;
                const height = parseFloat(heightInput.value) || 0;
                
                pageTitle.textContent = formatTentTitle(width, height);
            }
        };

        // Fun√ß√µes para incrementar/decrementar dimens√µes
        window.incrementDimension = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                let value = parseFloat(input.value) || 0;
                value = Math.max(0, value + 0.1);
                input.value = value.toFixed(1);
                input.dispatchEvent(new Event('input'));
            }
        };

        window.decrementDimension = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                let value = parseFloat(input.value) || 0;
                value = Math.max(0, value - 0.1);
                input.value = value.toFixed(1);
                input.dispatchEvent(new Event('input'));
            }
        };

        // Formatar CEP
        window.formatCEP = function(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            input.value = value;
        };

        // Calcular frete (placeholder - implementar integra√ß√£o com API de frete)
        window.calculateShipping = function() {
            const cepInput = document.getElementById('shipping-cep');
            const resultDiv = document.getElementById('shippingResult');
            const resultText = document.getElementById('shippingResultText');
            
            if (!cepInput || !resultDiv || !resultText) return;
            
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                alert('Por favor, digite um CEP v√°lido (8 d√≠gitos)');
                return;
            }
            
            // Placeholder - aqui seria feita a integra√ß√£o com API de frete
            resultText.textContent = `Frete para ${cep.substring(0, 5)}-${cep.substring(5)}: R$ XX,XX (Prazo: X dias √∫teis)`;
            resultDiv.style.display = 'block';
        };

        // Vari√°veis globais para o carrossel (tornar acess√≠veis globalmente)
        window.carouselImages = [];
        window.currentCarouselIndex = 0;
        let carouselImages = window.carouselImages;
        let currentCarouselIndex = window.currentCarouselIndex;

        // Fun√ß√µes do carrossel
        window.previousImage = function() {
            if (carouselImages.length === 0) return;
            currentCarouselIndex = (currentCarouselIndex - 1 + carouselImages.length) % carouselImages.length;
            window.currentCarouselIndex = currentCarouselIndex;
            goToImage(currentCarouselIndex);
        };

        window.nextImage = function() {
            if (carouselImages.length === 0) return;
            currentCarouselIndex = (currentCarouselIndex + 1) % carouselImages.length;
            window.currentCarouselIndex = currentCarouselIndex;
            goToImage(currentCarouselIndex);
        };

        window.goToImage = function(index) {
            if (index < 0 || index >= carouselImages.length) return;
            currentCarouselIndex = index;
            window.currentCarouselIndex = index;
            
            const mainImage = document.getElementById('mainProductImage');
            if (mainImage && carouselImages[index]) {
                // Fade out
                mainImage.classList.add('fade-out');
                
                setTimeout(() => {
                    mainImage.src = carouselImages[index].image;
                    mainImage.alt = carouselImages[index].alt || `Tenda - Varia√ß√£o ${index + 1}`;
                    mainImage.classList.remove('fade-out');
                    mainImage.classList.add('fade-in');
                    
                    // Re-detectar orienta√ß√£o
                    detectImageOrientation();
                    
                    // Atualizar indicadores
                    updateCarouselIndicators();
                }, 150);
            }
        };

        function updateCarouselIndicators() {
            const indicatorsContainer = document.getElementById('carouselIndicators');
            if (!indicatorsContainer) return;
            
            const indicators = indicatorsContainer.querySelectorAll('.carousel-indicator');
            indicators.forEach((indicator, index) => {
                if (index === currentCarouselIndex) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }

        function initializeCarousel(tent) {
            // Montar array de imagens: principal + varia√ß√µes
            carouselImages = [];
            window.carouselImages = carouselImages;
            
            // Adicionar imagem principal
            if (tent.mainImage) {
                carouselImages.push({
                    image: tent.mainImage,
                    alt: `Tenda ${tent.width}m √ó ${tent.height}m`,
                    isMain: true,
                    variation: null
                });
            }
            
            // Adicionar varia√ß√µes
            if (tent.variations && tent.variations.length > 0) {
                tent.variations.forEach(variation => {
                    carouselImages.push({
                        image: variation.image,
                        alt: `Tenda ${tent.width}m √ó ${tent.height}m - Varia√ß√£o ${variation.variation}`,
                        isMain: false,
                        variation: variation.variation
                    });
                });
            }
            
            // Atualizar refer√™ncia global
            window.carouselImages = carouselImages;
            
            // Se houver mais de uma imagem, mostrar carrossel
            if (carouselImages.length > 1) {
                const prevButton = document.getElementById('carouselPrev');
                const nextButton = document.getElementById('carouselNext');
                const indicatorsContainer = document.getElementById('carouselIndicators');
                
                if (prevButton) prevButton.style.display = 'flex';
                if (nextButton) nextButton.style.display = 'flex';
                if (indicatorsContainer) {
                    indicatorsContainer.style.display = 'flex';
                    // Criar indicadores
                    indicatorsContainer.innerHTML = '';
                    carouselImages.forEach((_, index) => {
                        const indicator = document.createElement('button');
                        indicator.className = 'carousel-indicator' + (index === 0 ? ' active' : '');
                        indicator.setAttribute('aria-label', `Ir para imagem ${index + 1}`);
                        indicator.onclick = () => goToImage(index);
                        indicatorsContainer.appendChild(indicator);
                    });
                }
            } else {
                // Ocultar controles do carrossel
                const prevButton = document.getElementById('carouselPrev');
                const nextButton = document.getElementById('carouselNext');
                const indicatorsContainer = document.getElementById('carouselIndicators');
                
                if (prevButton) prevButton.style.display = 'none';
                if (nextButton) nextButton.style.display = 'none';
                if (indicatorsContainer) indicatorsContainer.style.display = 'none';
            }
            
            // Resetar √≠ndice
            currentCarouselIndex = 0;
            window.currentCarouselIndex = 0;
        }

        // Preencher campos com valores da URL
        function fillDimensionsFromURL() {
            const params = getURLParams();
            
            // Buscar tenda do cat√°logo se tiver ID (prioridade) - usar baseId
            if (params.id && typeof TENT_CATALOG !== 'undefined') {
                const tent = TENT_CATALOG.find(t => t.baseId === params.id);
                if (tent) {
                    // Armazenar tipo e capacidade de c√°lculo
                    currentTentType = tent.type;
                    currentTentCanCalculate = tent.canCalculatePrice !== false;
                    currentTent = tent; // Armazenar objeto completo da tenda
                    
                    // Inicializar carrossel
                    initializeCarousel(tent);
                    
                    // Atualizar imagem principal
                    const mainImage = document.getElementById('mainProductImage');
                    if (mainImage && carouselImages.length > 0) {
                        mainImage.src = carouselImages[0].image;
                        mainImage.alt = carouselImages[0].alt;
                        // Re-detectar orienta√ß√£o quando a imagem carregar
                        if (mainImage.complete) {
                            detectImageOrientation();
                        } else {
                            mainImage.addEventListener('load', detectImageOrientation, { once: true });
                        }
                    }
                    
                    // Preencher dimens√µes da tenda encontrada
                    const widthInput = document.getElementById('tent-width-large');
                    const heightInput = document.getElementById('tent-height-large');
                    const dimensionsHeader = document.querySelector('.dimensions-header');
                    const dimensionsSubtitle = document.querySelector('.dimensions-subtitle-large');
                    
                    // Se MANDALA, desabilitar inputs e mostrar pre√ßo fixo
                    if (!currentTentCanCalculate) {
                        if (widthInput) {
                            widthInput.disabled = true;
                            widthInput.style.opacity = '0.5';
                            widthInput.style.cursor = 'not-allowed';
                        }
                        if (heightInput) {
                            heightInput.disabled = true;
                            heightInput.style.opacity = '0.5';
                            heightInput.style.cursor = 'not-allowed';
                        }
                        if (dimensionsSubtitle) {
                            dimensionsSubtitle.textContent = 'Pre√ßo fixo conforme modelo';
                        }
                        // Esconder bot√µes de incremento/decremento
                        document.querySelectorAll('.dimension-input-btn').forEach(btn => {
                            btn.style.display = 'none';
                        });
                        
                        // Adicionar mensagem informativa sobre medidas diferentes
                        const dimensionsContainer = document.querySelector('.dimensions-inputs-large');
                        if (dimensionsContainer) {
                            // Verificar se j√° existe a mensagem
                            let infoMessage = dimensionsContainer.querySelector('.mandala-info-message');
                            if (!infoMessage) {
                                infoMessage = document.createElement('p');
                                infoMessage.className = 'mandala-info-message';
                                infoMessage.style.cssText = 'width: 100% !important; display: block; box-sizing: border-box; grid-column: 1 / -1; color: var(--color-text-secondary); font-size: 0.875rem; margin-top: var(--spacing-sm); padding: var(--spacing-xs); background-color: var(--color-bg-primary); border-radius: 6px; border-left: 3px solid var(--color-accent-primary);';
                                infoMessage.textContent = 'üí° Se voc√™ deseja medidas diferentes deste modelo, informe nas observa√ß√µes do carrinho.';
                                dimensionsContainer.appendChild(infoMessage);
                            }
                        }
                        
                        // Calcular e mostrar pre√ßo fixo
                        calculateTentPriceLarge('tendas');
                    } else {
                        if (widthInput) {
                            widthInput.disabled = false;
                            widthInput.style.opacity = '1';
                            widthInput.style.cursor = 'text';
                        }
                        if (heightInput) {
                            heightInput.disabled = false;
                            heightInput.style.opacity = '1';
                            heightInput.style.cursor = 'text';
                        }
                        if (dimensionsSubtitle) {
                            dimensionsSubtitle.textContent = 'R$ 22,00 por m¬≤';
                        }
                        document.querySelectorAll('.dimension-input-btn').forEach(btn => {
                            btn.style.display = 'flex';
                        });
                    }
                    
                    // Usar dimens√µes da URL se fornecidas, sen√£o usar da tenda
                    if (params.width && params.height) {
                        if (widthInput) widthInput.value = params.width;
                        if (heightInput) heightInput.value = params.height;
                    } else {
                        if (widthInput) widthInput.value = tent.width;
                        if (heightInput) heightInput.value = tent.height;
                    }
                    
                    // Calcular pre√ßo automaticamente (ou mostrar "Sob consulta")
                    calculateTentPriceLarge('tendas');
                    updateProductTitle();
                    
                    // Atualizar t√≠tulo da p√°gina
                    const pageTitle = document.querySelector('.product-page-title');
                    if (pageTitle) {
                        if (widthInput && heightInput && widthInput.value && heightInput.value) {
                            const width = parseFloat(widthInput.value) || 0;
                            const height = parseFloat(heightInput.value) || 0;
                            pageTitle.textContent = formatTentTitle(width, height, tent);
                        } else {
                            pageTitle.textContent = formatTentTitle(tent.width, tent.height, tent);
                        }
                    }
                    
                    // Atualizar imagem do bot√£o de adicionar ao carrinho
                    const addButton = document.getElementById('btn-add-tent-large');
                    if (addButton && carouselImages.length > 0) {
                        addButton.setAttribute('data-product-image', carouselImages[0].image);
                    }
                    
                    // Gerar thumbnails
                    generateThumbnails();
                    return;
                }
            }
            
            // Se n√£o encontrou pelo ID, usar dimens√µes da URL se fornecidas
            if (params.width && params.height) {
                const widthInput = document.getElementById('tent-width-large');
                const heightInput = document.getElementById('tent-height-large');
                
                if (widthInput) widthInput.value = params.width;
                if (heightInput) heightInput.value = params.height;
                
                // Calcular pre√ßo automaticamente
                calculateTentPriceLarge('tendas');
                updateProductTitle();
            }
            
            // Gerar thumbnails
            generateThumbnails();
        }

        // Gerar thumbnails da galeria
        function generateThumbnails() {
            const thumbnailsContainer = document.getElementById('productThumbnails');
            const mainImage = document.getElementById('mainProductImage');
            
            if (!thumbnailsContainer || !mainImage) return;
            
            // Por enquanto, usar a mesma imagem (pode ser expandido depois)
            const currentImageSrc = mainImage.src;
            
            // Criar 3 thumbnails (mesma imagem por enquanto)
            thumbnailsContainer.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'thumbnail' + (i === 0 ? ' active' : '');
                thumbnail.innerHTML = `<img src="${currentImageSrc}" alt="Tenda - Vista ${i + 1}" loading="lazy">`;
                thumbnail.onclick = function() {
                    // Remover active de todos
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    // Adicionar active ao clicado
                    this.classList.add('active');
                    // Atualizar imagem principal
                    mainImage.src = this.querySelector('img').src;
                    detectImageOrientation();
                };
                thumbnailsContainer.appendChild(thumbnail);
            }
        }

        // Detectar orienta√ß√£o da imagem e ajustar layout
        function detectImageOrientation() {
            const mainImage = document.getElementById('mainProductImage');
            const imageContainer = document.querySelector('.product-main-image');
            
            if (!mainImage || !imageContainer) return;
            
            function checkAndApply() {
                const width = mainImage.naturalWidth;
                const height = mainImage.naturalHeight;
                
                if (width > 0 && height > 0) {
                    applyOrientation(mainImage, imageContainer);
                }
            }
            
            // Se a imagem j√° est√° carregada
            if (mainImage.complete && mainImage.naturalWidth > 0) {
                checkAndApply();
            } else {
                // Esperar a imagem carregar
                mainImage.addEventListener('load', function() {
                    checkAndApply();
                }, { once: true });
                
                // Fallback: tentar novamente ap√≥s um tempo
                setTimeout(function() {
                    if (mainImage.naturalWidth > 0) {
                        checkAndApply();
                    }
                }, 500);
            }
        }
        
        function applyOrientation(img, container) {
            const width = img.naturalWidth;
            const height = img.naturalHeight;
            
            console.log('Dimens√µes da imagem:', width, 'x', height); // Debug
            
            // Remover classes anteriores
            container.classList.remove('image-landscape', 'image-portrait');
            
            // Determinar orienta√ß√£o (com margem de toler√¢ncia)
            const ratio = width / height;
            
            if (ratio > 1.1) {
                // Paisagem (largura significativamente maior)
                container.classList.add('image-landscape');
                console.log('Aplicando classe: image-landscape');
            } else if (ratio < 0.9) {
                // Retrato (altura significativamente maior)
                container.classList.add('image-portrait');
                console.log('Aplicando classe: image-portrait');
            } else {
                // Quase quadrado - usar paisagem como padr√£o
                container.classList.add('image-landscape');
                console.log('Aplicando classe: image-landscape (quase quadrado)');
            }
        }

        // Navega√ß√£o por teclado para o carrossel
        document.addEventListener('keydown', function(e) {
            // S√≥ funcionar se houver imagens no carrossel e n√£o estiver digitando em um input
            if (carouselImages.length > 1 && 
                e.target.tagName !== 'INPUT' && 
                e.target.tagName !== 'TEXTAREA') {
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    previousImage();
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    nextImage();
                }
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            fillDimensionsFromURL();
            renderRelatedProducts();
            
            // Gerar thumbnails
            generateThumbnails();
            
            // Detectar orienta√ß√£o ap√≥s um pequeno delay para garantir que a imagem foi carregada
            setTimeout(detectImageOrientation, 300);
            
            // Tentar novamente ap√≥s mais tempo caso a imagem demore para carregar
            setTimeout(detectImageOrientation, 1000);
            
            const tentButton = document.getElementById('btn-add-tent-large');
            if (tentButton) {
                // Se j√° tiver valores preenchidos, habilitar bot√£o
                const widthInput = document.getElementById('tent-width-large');
                const heightInput = document.getElementById('tent-height-large');
                
                if (widthInput && heightInput && widthInput.value && heightInput.value) {
                    tentButton.disabled = false;
                    tentButton.style.opacity = '1';
                    tentButton.style.cursor = 'pointer';
                } else {
                    tentButton.disabled = true;
                    tentButton.style.opacity = '0.5';
                    tentButton.style.cursor = 'not-allowed';
                }
            }
        });
    </script>
</body>
</html>
